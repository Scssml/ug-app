(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-12a1cea1"],{3873:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",{staticClass:"pa-0",attrs:{fluid:""}},[i("v-dialog",{attrs:{value:t.loadingDialog,persistent:"","max-width":"320px"}},[i("v-list",t._l(t.loadingData,function(e,a){return i("v-list-tile",{key:a,attrs:{avatar:"",color:e.error?"red":e.color}},[i("v-list-tile-avatar",[i("v-progress-circular",{attrs:{value:100,size:30,color:e.error?"red":e.color,indeterminate:e.loading}})],1),i("v-list-tile-content",[i("v-list-tile-title",[t._v(t._s(e.title))])],1)],1)}))],1),t.loadingDialog?t._e():[i("v-card",[i("v-card-title",[i("v-text-field",{attrs:{"prepend-icon":"search",label:"Поиск","single-line":"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),i("v-spacer"),i("v-dialog",{attrs:{persistent:"","max-width":t.editDialog?"1200px":"420px"},model:{value:t.dialogForm,callback:function(e){t.dialogForm=e},expression:"dialogForm"}},[t.editedId&&t.editDialog?i("bouquet-edit",{attrs:{id:t.editedId},on:{cancel:function(e){t.closeDialog()}}}):t._e(),t.editedId&&t.cancelDialog?i("bouquet-cancel",{attrs:{id:t.editedId},on:{cancel:function(e){t.closeDialog()}}}):t._e()],1)],1),i("v-data-table",{attrs:{headers:t.headersTable,items:t.bouquetsList,"hide-actions":"","no-data-text":"Букетов не найдено","no-results-text":"Букетов не найдено",search:t.search},scopedSlots:t._u([{key:"items",fn:function(e){return[i("td",{staticClass:"text-xs-right",staticStyle:{width:"30px"}},[t._v(t._s(e.item.id))]),i("td",[t._v("\n            "+t._s(e.item.client.name)+"\n            "),i("br"),t._v(t._s(e.item.client.phone)+"\n          ")]),i("td",[t._v(t._s(e.item.florist))]),i("td",[t._v(t._s(e.item.user.name))]),i("td",[t._v("\n            "+t._s(e.item.payments[e.item.payments.length-1].amount)+"р\n            "),i("br"),t._v(t._s(e.item.payments[e.item.payments.length-1].creationDate)+"\n            "),i("br"),t._v(t._s(e.item.payments[e.item.payments.length-1].paymentType.name)+"\n          ")]),i("td",{staticClass:"text-xs-right",staticStyle:{width:"140px"}},[i("v-icon",{on:{click:function(i){t.printDoc(e.item.id)}}},[t._v("\n              insert_drive_file\n            ")]),i("v-icon",{staticClass:"ml-2",on:{click:function(i){t.editItem(e.item.id)}}},[t._v("\n              visibility\n            ")]),e.item.payments.every(function(t){return 7!==t.paymentType.id})?i("v-icon",{staticClass:"ml-2",on:{click:function(i){t.cancelItem(e.item.id)}}},[t._v("\n              delete\n            ")]):t._e()],1)]}}])})],1)]],2)},n=[],s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-card",[i("v-alert",{staticClass:"my-0",attrs:{value:t.createdSuccess,type:"success"}},[t._v("Букет изменен")]),t.loading?t._e():i("v-form",{ref:"form",attrs:{"lazy-validation":""}},[i("v-card-title",{staticClass:"px-4"},[i("span",{staticClass:"headline"},[t._v("Просмотр букета №"+t._s(t.id))])]),i("v-divider"),i("v-card-text",{staticClass:"px-4"},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{xs6:"","px-2":""}},[i("p",{staticClass:"title mb-4"},[t._v("Букет")]),i("v-text-field",{attrs:{label:"Клиент",value:t.editedItem.client.name+" ("+t.editedItem.client.phone+")",readonly:""}}),i("v-text-field",{attrs:{label:"Флорист",value:t.editedItem.florist,readonly:""}}),i("v-text-field",{attrs:{label:"Менеджер",value:t.editedItem.user.name,readonly:""}}),i("v-text-field",{attrs:{label:"Оформление",value:t.editedItem.decorCost+" ("+t.editedItem.decorPercent+"%)",readonly:""}}),i("v-text-field",{attrs:{label:"Скидка",value:t.editedItem.sumSale+" ("+t.editedItem.salePercent+"%)",readonly:""}}),i("v-text-field",{attrs:{label:"Доставка",value:t.editedItem.deliveryCost,readonly:""}}),i("v-textarea",{attrs:{label:"Комментарий к доставке","auto-grow":"",value:t.editedItem.comment,"row-height":"15",readonly:""}}),t.editedItem.orderId?i("v-text-field",{attrs:{label:"Заказ",value:t.editedItem.orderId,readonly:""}}):t._e(),t.editedItem.orderBouquet?i("v-text-field",{attrs:{label:"Букет из заказа",value:t.editedItem.orderBouquet.name+" - "+t.editedItem.orderBouquet.count+"шт",readonly:""}}):t._e()],1),i("v-flex",{attrs:{xs6:"","px-2":""}},[i("p",{staticClass:"title mb-4"},[t._v("Оплаты")]),t._l(t.editedItem.payments,function(e,a){return[i("v-card",{key:a,attrs:{flat:""}},[i("v-text-field",{attrs:{label:"Дата",value:e.creationDate,readonly:""}}),i("v-text-field",{attrs:{label:"Стоимость",value:e.amount,readonly:""}}),i("v-text-field",{attrs:{label:"Тип оплаты",value:e.paymentType.name,readonly:""}}),7===e.paymentType.id?i("v-textarea",{attrs:{label:"Комментарий к оплате","auto-grow":"",value:e.description,"row-height":"20",readonly:""}}):t._e()],1)]})],2),i("v-flex",{attrs:{xs12:"","px-2":"","mt-4":""}},[i("p",{staticClass:"title mb-4"},[t._v("Товары")]),i("v-data-table",{attrs:{headers:t.headersTableGoods,items:t.editedItem.goods,"hide-actions":"","no-data-text":"Товаров не найдено","no-results-text":"Товаров не найдено"},scopedSlots:t._u([{key:"items",fn:function(e){return[i("td",[t._v(t._s(e.item.good.name))]),i("td",[t._v(t._s(e.item.good.price))]),i("td",[t._v(t._s(e.item.count))])]}}])})],1)],1)],1),i("v-card-actions",{staticClass:"px-4 pb-4"},[i("v-btn",{nativeOn:{click:function(e){t.cancel()}}},[t._v("Отмена")])],1)],1)],1)},o=[],r={props:{id:{type:Number,required:!0}},data:function(){return{loading:!0,editedItem:{},createdSuccess:!1,headersTableGoods:[{text:"Название",align:"left",value:"good.name"},{text:"Стоимость",align:"left",value:"good.price"},{text:"Количество",align:"left",value:"count"}]}},methods:{getItem:function(){var t=this;if(this.id){var e={type:"bouquets",id:this.id};this.$store.dispatch("getItem",e).then(function(e){t.editedItem=e,t.loading=!1}).catch(function(){console.log("error")})}},cancel:function(){this.editedItem={},this.createdSuccess=!1,this.$emit("cancel")},submitForm:function(){var t=this,e=this.$refs.form.validate();if(e){var i=Object.assign({},this.editedItem);delete i.id;var a={type:"payments",id:this.id,props:i};this.$store.dispatch("updateItem",a).then(function(){t.createdSuccess=!0,setTimeout(function(){t.$emit("cancel")},1e3)})}}},mounted:function(){this.getItem()}},l=r,d=i("2877"),c=Object(d["a"])(l,s,o,!1,null,null,null),u=c.exports,m=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-card",[i("v-alert",{staticClass:"my-0",attrs:{value:t.createdSuccess,type:"success"}},[t._v("Возврат выполнен")]),t.loading?t._e():i("v-form",{ref:"form",attrs:{"lazy-validation":""}},[i("v-card-title",{staticClass:"px-4"},[i("span",{staticClass:"headline"},[t._v("Возврат букета №"+t._s(t.id))])]),i("v-divider"),i("v-card-text",{staticClass:"px-4"},[i("v-textarea",{attrs:{label:"Комментарий","auto-grow":"",rules:[function(t){return!!t||"Заполните поле"}],"row-height":"12"},model:{value:t.editedItem.description,callback:function(e){t.$set(t.editedItem,"description",e)},expression:"editedItem.description"}})],1),i("v-card-actions",{staticClass:"px-4 pb-4"},[i("v-btn",{nativeOn:{click:function(e){t.cancel()}}},[t._v("Отмена")]),i("v-spacer"),i("v-btn",{attrs:{color:"info"},on:{click:t.submitForm}},[t._v("Сохранить")])],1)],1)],1)},v=[],p={props:{id:{type:Number,required:!0}},data:function(){return{loading:!0,propsItem:{},editedItem:{description:null},createdSuccess:!1}},methods:{getItem:function(){var t=this;if(this.id){var e={type:"bouquets",id:this.id};this.$store.dispatch("getItem",e).then(function(e){t.propsItem=e,t.loading=!1}).catch(function(){console.log("error")})}},cancel:function(){this.editedItem={},this.createdSuccess=!1,this.$emit("cancel")},submitForm:function(){var t=this,e=this.$refs.form.validate();if(e){var i=Object.assign({},this.editedItem);delete i.id;var a={type:"bouquets",id:this.id,props:i};this.$store.dispatch("deleteItem",a).then(function(){t.createdSuccess=!0,t.createdBouquet(),setTimeout(function(){t.$emit("cancel")},1e3)})}},createdBouquet:function(){var t=JSON.parse(localStorage.getItem("cardsList"));t=null!==t?t:[];var e=this.propsItem,i=t.findIndex(function(t){return t.props.order===e.id}),a={clientId:e.client.id,decorCost:e.decorCost,decorPercent:e.decorPercent,deliveryCost:e.deliveryCost,floristId:e.florist?e.florist:0,orderId:0,payment:{amount:e.payments[0].amount,clientId:e.client.id,description:e.payments[0].description,paymentTypeId:e.payments[0].paymentType.id},salePercent:e.salePercent,sumSale:e.sumSale,totalCost:e.payments[0].amount},n=e.goods.map(function(t){var e={id:t.good.id,name:t.good.name,price:t.good.price,sortIndex:t.good.sortIndex,stockBalance:t.good.stockBalance,value:t.count};return e}),s=e.goods.reduce(function(t,e){var i=e.good.price*e.count;return t+i},0);-1===i?t.push({sum:s,success:!1,props:a,goods:n}):t[i].props.clientId=e.client.id,localStorage.setItem("cardsList",JSON.stringify(t)),this.$router.push({path:"/",query:{selectOrder:e.id}})}},mounted:function(){this.getItem()}},f=p,h=Object(d["a"])(f,m,v,!1,null,null,null),g=h.exports,y={name:"Bouquets",components:{BouquetEdit:u,BouquetCancel:g},data:function(){return{loadingData:[{title:"Получение букетов",error:!1,loading:!0,color:"cyan",id:"bouquets"}],search:"",headersTable:[{text:"ID",align:"right",value:"id"},{text:"Клиент",align:"left",value:"client.name"},{text:"Флорист",align:"left",value:"florist"},{text:"Менеджер",align:"left",value:"user.name"},{text:"Оплата",align:"left",value:"payments[0].amount",sortable:!1},{text:"",align:"right",sortable:!1,value:"action"}],dialogForm:!1,editDialog:!1,cancelDialog:!1,editedId:0,bouquetsList:[]}},computed:{loadingDialog:function(){var t=this.loadingData.filter(function(t){return!t.error&&!t.loading});return t.length===this.loadingData.length?0:1}},methods:{printDoc:function(t){var e=window.location,i=e.protocol,a=e.hostname,n="".concat(i,"//").concat(a,"/print/bouquet/").concat(t,"/receipt");window.open(n,"_blank")},getBouquetsList:function(){var t=this,e={type:"bouquets"},i="Букеты получены!",a="Ошибка получения букетов!";this.$store.dispatch("getItemsList",e).then(function(a){t.bouquetsList=a.map(function(t){return t.payments.sort(function(t,e){return t.creationDate>e.creationDate?1:-1}),t});var n=t.loadingData.find(function(t){return t.id===e.type});n.title=i,n.loading=!1}).catch(function(){var i=t.loadingData.find(function(t){return t.id===e.type});i.title=a,i.error=!0})},closeDialog:function(){this.getBouquetsList(),this.dialogForm=!1,this.editedId=0,this.cancelDialog=!1,this.editDialog=!1},editItem:function(t){this.editedId=+t,this.dialogForm=!0,this.editDialog=!0},cancelItem:function(t){this.editedId=+t,this.dialogForm=!0,this.cancelDialog=!0}},mounted:function(){this.getBouquetsList()}},x=y,I=(i("93ed"),Object(d["a"])(x,a,n,!1,null,"4576ba46",null));e["default"]=I.exports},"57e5":function(t,e,i){},"93ed":function(t,e,i){"use strict";var a=i("57e5"),n=i.n(a);n.a}}]);
//# sourceMappingURL=chunk-12a1cea1.91d72dbb.js.map