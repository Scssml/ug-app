(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-765913bf"],{"21bb":function(t,e,s){"use strict";var a=s("bcc9"),i=s.n(a);i.a},"642e":function(t,e,s){"use strict";var a=s("6a0e"),i=s.n(a);i.a},"6a0e":function(t,e,s){},bb51:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-container",{staticClass:"pa-0",attrs:{fluid:""}},[t.checkSum>0?s("v-snackbar",{attrs:{value:!0,color:"info",bottom:"",timeout:36e5}},[t._v("\n    Общая стоимость: "+t._s(t.checkSum)+"\n    "),s("v-btn",{attrs:{color:"error",depressed:""},on:{click:t.deleteCheckCards}},[t._v("Удалить")]),s("v-btn",{attrs:{color:"info",depressed:""},on:{click:function(e){t.dialogPay=!0}}},[t._v("Оплатить")])],1):t._e(),s("v-dialog",{attrs:{value:t.loadingDialog,persistent:"","max-width":"320px"}},[s("v-list",t._l(t.loadingData,function(e,a){return s("v-list-tile",{key:a,attrs:{avatar:"",color:e.error?"red":e.color}},[s("v-list-tile-avatar",[s("v-progress-circular",{attrs:{value:100,size:30,color:e.error?"red":e.color,indeterminate:e.loading}})],1),s("v-list-tile-content",[s("v-list-tile-title",[t._v(t._s(e.title))])],1)],1)}))],1),t.loadingDialog?t._e():s("payment-day",{attrs:{"payments-list":t.paymentsList},on:{input:function(e){t.getPaymentsList()}}}),t.loadingDialog?t._e():s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs4:""}},t._l(t.propsBouquet,function(e,a){return s("v-card",{key:a,attrs:{flat:""}},[s("div",{staticClass:"py-1 px-3 text-xs-right",style:"height: "+(e?30:40)+"px;"},[t._v("\n          "+t._s(e)+"\n        ")]),s("v-divider")],1)})),s("v-flex",{attrs:{xs8:""}},[s("v-container",{staticClass:"scroll-y pa-0 right-block",staticStyle:{overflow:"auto"},attrs:{id:"scroll-block-top"}},[s("v-layout",{directives:[{name:"scroll",rawName:"v-scroll:#scroll-block-top",value:t.onScroll,expression:"onScroll",arg:"#scroll-block-top"}],attrs:{row:""}},[t._l(t.cardsList,function(e,a){return[e.success?t._e():s("v-flex",{key:a},[s("created-bouquet-card",{attrs:{"florists-list":t.floristsList,"clients-list":t.clientsList,"payment-types-list":t.paymentTypesList,sumFlowers:e.sum,propsDefault:e.props},on:{saveProps:function(e){t.saveProps(a,e)},updateProps:function(e){t.updateProps(a,e)},copy:function(e){t.copyItem(a)},delete:function(e){t.deleteItem(a)},checkCard:function(e){t.checkCard(a,e)}}})],1)]}),s("v-flex",{staticStyle:{"align-self":"center"}},[s("v-btn",{staticClass:"mx-4",attrs:{fab:"",large:"",color:"info"},on:{click:t.addCard}},[s("v-icon",{attrs:{dark:""}},[t._v("add")])],1)],1)],2)],1)],1)],1),t.loadingDialog?t._e():s("v-layout",{staticStyle:{"min-height":"100px",height:"528px","overflow-y":"scroll"},attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs4:""}},[s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",[s("v-card",{attrs:{flat:""}},[s("div",{staticClass:"py-1 px-1 text-xs-center",staticStyle:{height:"30px"}},[t._v("Остаток")]),s("v-divider"),t._l(t.goodsList,function(e,a){return[s("div",{key:a,staticClass:"py-1 px-1 text-xs-center",staticStyle:{height:"30px"}},[t._v(t._s(e.stockBalance))]),s("v-divider",{key:"divider-"+a})]})],2)],1),s("v-flex",[s("v-card",{attrs:{flat:""}},[s("div",{staticClass:"py-1 px-1 text-xs-center",staticStyle:{height:"30px"}},[t._v("Наименование")]),s("v-divider"),t._l(t.goodsList,function(e,a){return[s("div",{key:a,staticClass:"py-1 px-1 text-xs-center",staticStyle:{height:"30px"}},[t._v(t._s(e.name))]),s("v-divider",{key:"divider-"+a})]})],2)],1),s("v-flex",[s("v-card",{attrs:{flat:""}},[s("div",{staticClass:"py-1 px-1 text-xs-center",staticStyle:{height:"30px"}},[t._v("Цена")]),s("v-divider"),t._l(t.goodsList,function(e,a){return[s("div",{key:a,staticClass:"py-1 px-1 text-xs-center",staticStyle:{height:"30px"}},[t._v(t._s(e.price))]),s("v-divider",{key:"divider-"+a})]})],2)],1)],1)],1),s("v-flex",{staticStyle:{"padding-left":"6px"},attrs:{xs8:""}},[s("v-container",{staticClass:"scroll-y pa-0 right-block",staticStyle:{overflow:"hidden"},attrs:{id:"scroll-block-bottom"}},[s("v-layout",{attrs:{row:""}},[t._l(t.cardsList,function(e,a){return[e.success?t._e():s("v-flex",{key:a},[s("select-count-goods",{key:a,attrs:{"goods-list":t.goodsList,"selected-goods-default":e.goods},on:{changeSum:function(e){t.setSum(a,e)},changeGoods:function(e){t.setGoods(a,e)}}})],1)]}),s("v-flex",[s("div",{staticStyle:{width:"120px"}})])],2)],1)],1)],1),s("v-dialog",{attrs:{persistent:"","max-width":"420px"},model:{value:t.dialogPay,callback:function(e){t.dialogPay=e},expression:"dialogPay"}},[s("v-card",[s("v-alert",{staticClass:"my-0",attrs:{value:t.createdSuccess,type:"success"}},[t._v("\n        Букеты созданы\n      ")]),s("v-form",{ref:"form",attrs:{"lazy-validation":""}},[s("v-card-title",{staticClass:"px-4"},[s("span",{staticClass:"headline"},[t._v("Оплата заказа")])]),s("v-divider"),s("v-card-text",{staticClass:"px-4"},[s("v-text-field",{attrs:{label:"К оплате",readonly:"",value:t.checkSum}}),"На баланс"!==t.typePay?s("v-text-field",{attrs:{label:"Сумма",rules:[function(e){return e>=t.checkSum||"На баланс"===t.typePay||"Заполните поле"}]},model:{value:t.sumClient,callback:function(e){t.sumClient=e},expression:"sumClient"}}):t._e(),"На баланс"!==t.typePay?s("v-text-field",{attrs:{label:"Сдача",readonly:"",value:t.sumChange}}):t._e(),s("v-select",{attrs:{label:"Способ оплаты",items:t.typePayList,rules:[function(t){return!!t||"Заполните поле"}],"item-text":"name","item-value":"id"},model:{value:t.typePay,callback:function(e){t.typePay=e},expression:"typePay"}})],1),s("v-card-actions",{staticClass:"px-4 pb-4"},[s("v-btn",{nativeOn:{click:function(e){t.dialogPay=!1}}},[t._v("Отмена")]),s("v-spacer"),s("v-btn",{attrs:{color:"info"},on:{click:function(e){t.pay()}}},[t._v("Оплатить")])],1)],1)],1)],1)],1)},i=[],r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-card",{class:t.$route.query.selectOrder===t.order?"selected":"",staticStyle:{"border-left":"1px solid #ccc","font-size":"16px"},attrs:{flat:"",width:"300"}},[s("div",{staticClass:"px-0",staticStyle:{height:"30px"}},[s("v-select",{staticClass:"scs-small",attrs:{label:"Флорист",items:t.floristsList,"item-text":"name","item-value":"id",solo:"",flat:"","hide-details":"","no-data-text":"Не найдено"},on:{change:function(e){t.updateProps()}},model:{value:t.florist,callback:function(e){t.florist=t._n(e)},expression:"florist"}})],1),s("v-divider"),s("div",{staticClass:"px-0",staticStyle:{height:"30px"}},[s("v-autocomplete",{staticClass:"mb-4 scs-small",attrs:{label:"Клиент",items:t.clientsList,filter:t.clientsFilter,"item-text":"name","item-value":"id",solo:"",flat:"","hide-details":"","no-data-text":"Не надено"},on:{change:function(e){t.updateProps(),t.getOrdersClient()}},model:{value:t.client,callback:function(e){t.client=t._n(e)},expression:"client"}})],1),s("v-divider"),s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs5:""}},[s("div",{staticClass:"pl-0",staticStyle:{height:"30px"}},[s("v-select",{staticClass:"scs-small",attrs:{label:"Заказ",items:t.clientOrdersList,"item-text":"id","item-value":"id",solo:"",flat:"","hide-details":"","no-data-text":"Нет заказов"},on:{change:function(e){t.updateProps()}},model:{value:t.order,callback:function(e){t.order=t._n(e)},expression:"order"}})],1)]),s("v-flex",{attrs:{xs7:""}},[s("div",{staticClass:"pr-0",staticStyle:{height:"30px"}},[s("v-select",{staticClass:"scs-small",attrs:{label:"Букет",items:t.orderBouquets,"item-text":"fullName","item-value":"id",solo:"",flat:"","hide-details":"","no-data-text":"Нет букетов"},on:{change:function(e){t.updateProps()}},model:{value:t.orderBouquet,callback:function(e){t.orderBouquet=t._n(e)},expression:"orderBouquet"}})],1)])],1),s("v-divider"),s("div",{staticClass:"px-0",staticStyle:{height:"30px"}},[s("v-text-field",{staticClass:"scs-small",attrs:{label:"Оформление, %",solo:"",flat:"","hide-details":""},on:{change:function(e){t.updateProps()}},model:{value:t.decorPercent,callback:function(e){t.decorPercent=t._n(e)},expression:"decorPercent"}})],1),s("v-divider"),s("div",{staticClass:"px-0",staticStyle:{height:"30px"}},[s("v-text-field",{staticClass:"scs-small",attrs:{label:"0",solo:"",flat:"","hide-details":"",value:t.sumFlowers,readonly:""}})],1),s("v-divider"),s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs3:""}},[s("div",{staticClass:"px-0",staticStyle:{height:"30px"}},[s("v-text-field",{staticClass:"scs-small",attrs:{label:"Доставка",solo:"",flat:"","hide-details":""},on:{change:function(e){t.updateProps()}},model:{value:t.delivery,callback:function(e){t.delivery=t._n(e)},expression:"delivery"}})],1)]),s("v-flex",{attrs:{xs9:""}},[s("div",{staticClass:"px-0",staticStyle:{height:"30px"}},[s("v-text-field",{staticClass:"scs-small",attrs:{label:"Комментарий",solo:"",flat:"","hide-details":""},on:{change:function(e){t.updateProps()}},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],1)])],1),s("v-divider"),s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs6:""}},[s("div",{staticClass:"px-0",staticStyle:{height:"30px"}},[s("v-text-field",{staticClass:"scs-small",attrs:{label:"0",solo:"",flat:"","hide-details":"",value:t.sumDecor,readonly:""}})],1)]),s("v-flex",{attrs:{xs6:""}},[s("div",{staticClass:"px-0",staticStyle:{height:"30px"}},[s("v-text-field",{staticClass:"scs-small",attrs:{label:"0",solo:"",flat:"","hide-details":"",type:"number"},on:{input:function(e){t.updateProps()}},model:{value:t.sumDecorAdditional,callback:function(e){t.sumDecorAdditional=t._n(e)},expression:"sumDecorAdditional"}})],1)])],1),s("v-divider"),s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs6:""}},[s("div",{staticClass:"px-0",staticStyle:{height:"30px"}},[s("v-text-field",{staticClass:"scs-small",attrs:{label:"Скидка, %",solo:"",flat:"","hide-details":"",value:t.clientSale,"background-color":t.clientSale>0?"deep-orange lighten-4":""},on:{input:function(e){t.clientSaleCustom=e},change:function(e){t.updateProps()}}})],1)]),s("v-flex",{attrs:{xs6:""}},[s("div",{staticClass:"px-0",staticStyle:{height:"30px"}},[s("v-text-field",{staticClass:"scs-small",attrs:{label:"0",solo:"",flat:"","hide-details":"",value:t.sumSale,readonly:""}})],1)])],1),s("v-divider"),s("div",{staticClass:"pl-0",staticStyle:{height:"30px"}},[s("v-text-field",{staticClass:"scs-small",attrs:{label:"0",solo:"",flat:"","hide-details":"",value:t.sumPay,readonly:""}})],1),s("v-divider"),s("div",{staticClass:"px-0 text-xs-center",staticStyle:{height:"40px"}},[s("v-btn",{attrs:{color:"info",small:""},nativeOn:{click:function(e){t.dialogPay=!0}}},[t._v("Оплатить")]),s("v-btn",{staticClass:"mx-0",attrs:{flat:"",small:"",color:"error"},nativeOn:{click:function(e){t.dialogClear=!0}}},[s("v-icon",{attrs:{dark:""}},[t._v("clear")])],1),s("v-btn",{staticClass:"mx-0",attrs:{flat:"",small:"",color:"warning"},nativeOn:{click:function(e){t.$emit("copy")}}},[s("v-icon",{attrs:{dark:""}},[t._v("library_add")])],1),s("div",{staticClass:"pr-0 input-min",staticStyle:{height:"30px"}},[s("v-text-field",{staticClass:"scs-small text-lg-right",attrs:{label:"Кол-во",solo:"",flat:"","hide-details":""},model:{value:t.bouquetCount,callback:function(e){t.bouquetCount=e},expression:"bouquetCount"}})],1),s("v-btn",{staticClass:"mx-0",attrs:{flat:"",small:"",color:"gray"},on:{click:function(e){t.checkCard()}}},[t.check?s("v-icon",{attrs:{dark:""}},[t._v("check_box")]):s("v-icon",{attrs:{dark:""}},[t._v("check_box_outline_blank")])],1)],1),s("v-divider"),s("v-dialog",{attrs:{persistent:"","max-width":"420px"},model:{value:t.dialogPay,callback:function(e){t.dialogPay=e},expression:"dialogPay"}},[s("v-card",[s("v-alert",{staticClass:"my-0",attrs:{value:t.createdSuccess,type:"success"}},[t._v("\n        Букет создан\n      ")]),s("v-form",{ref:"form",attrs:{"lazy-validation":""}},[s("v-card-title",{staticClass:"px-4"},[s("span",{staticClass:"headline"},[t._v("Оплата заказа")])]),s("v-divider"),s("v-card-text",{staticClass:"px-4"},[null!==t.orderBouquet?s("v-text-field",{attrs:{label:"К оплате",readonly:"",value:t.sumPay}}):t._e(),null===t.orderBouquet?s("v-text-field",{attrs:{label:"К оплате"},model:{value:t.sumPayCustom,callback:function(e){t.sumPayCustom=t._n(e)},expression:"sumPayCustom"}}):t._e(),null!==t.orderBouquet?s("v-text-field",{attrs:{label:"Сумма",rules:[function(e){return e>=t.sumPay||5===t.typePay||"Заполните поле"}]},model:{value:t.sumClient,callback:function(e){t.sumClient=e},expression:"sumClient"}}):t._e(),null!==t.orderBouquet?s("v-text-field",{attrs:{label:"Сдача",readonly:"",value:t.sumChange}}):t._e(),s("v-select",{attrs:{label:"Способ оплаты",items:t.typePayList,rules:[function(t){return!!t||"Заполните поле"}],"item-text":"name","item-value":"id"},model:{value:t.typePay,callback:function(e){t.typePay=e},expression:"typePay"}})],1),s("v-card-actions",{staticClass:"px-4 pb-4"},[s("v-btn",{nativeOn:{click:function(e){t.dialogPay=!1}}},[t._v("Отмена")]),s("v-spacer"),s("v-btn",{attrs:{color:"info"},on:{click:t.submitForm}},[t._v("Оплатить")])],1)],1)],1)],1),s("v-dialog",{attrs:{persistent:"","max-width":"320px"},model:{value:t.dialogClear,callback:function(e){t.dialogClear=e},expression:"dialogClear"}},[s("v-card",[s("v-card-title",{staticClass:"px-4"},[s("span",{staticClass:"headline"},[t._v("Очистить?")])]),s("v-divider"),s("v-card-actions",{staticClass:"px-4 py-3"},[s("v-btn",{nativeOn:{click:function(e){t.dialogClear=!1}}},[t._v("Отмена")]),s("v-spacer"),s("v-btn",{attrs:{color:"error"},on:{click:function(e){t.$emit("delete")}}},[t._v("Очистить")])],1)],1)],1)],1)},l=[],n={name:"CreatedBouquetCard",props:{floristsList:{type:Array,required:!0},clientsList:{type:Array,required:!0},paymentTypesList:{type:Array,required:!0},sumFlowers:{type:Number,required:!0},propsDefault:{type:Object}},data:function(){return{sumPayCustom:0,createdSuccess:!1,florist:0,client:7,order:0,decorPercent:10,delivery:0,comment:"",sumDecorAdditional:0,salePersent:null,dialogPay:!1,sumClient:0,typePay:null,dialogClear:!1,sumDecorCustom:"",clientSaleCustom:"",check:!1,bouquetCount:1,orderBouquet:null,clientOrdersList:[]}},computed:{orderBouquets:function(){var t=this,e=this.clientOrdersList.find(function(e){return e.id===t.order}),s=[];return e&&(s=e.bouquets.map(function(t){return t.fullName="".concat(t.name," - ").concat(t.count,"шт"),t})),s},typePayList:function(){var t=this;return this.paymentTypesList.filter(function(e){var s=!0;return 7===e.id?s=!1:5===e.id&&7===t.client&&(s=!1),s})},sumDecor:function(){var t=0;return t=""!==this.sumDecorCustom?this.sumDecorCustom:Math.ceil(this.sumFlowers*(this.decorPercent/100)),this.priceRound(t)},sumSale:function(){var t=Math.ceil((this.sumFlowers+this.sumDecor)*(this.clientSale/100));return this.priceRound(t)},sumPay:function(){var t=this.sumFlowers;return t+=this.sumDecor,t+=+this.delivery,t+=+this.sumDecorAdditional,t-=this.sumSale,this.priceRound(t)},sumChange:function(){var t=this.sumClient-this.sumPay;return t>0?t:0},activePayBtn:function(){var t=""!==this.florist?1:0;return t},clientSale:function(){var t=this,e=this.clientsList.find(function(e){return e.id===t.client});console.log(e);var s=0;return e&&(s=""!==this.clientSaleCustom?this.clientSaleCustom:7!==e&&e.sale>0?e.sale:this.sumFlowers+this.sumDecor>=3e3?5:null),s}},methods:{getOrdersClient:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&(this.order=0);var s={type:"orders",filter:{client:this.client,orderStatus:1}};this.$store.dispatch("getItemsList",s).then(function(e){t.clientOrdersList=e.map(function(t){return t.id=+t.id,t})}).catch(function(){console.log("error")})},clearProps:function(){this.florist=0,this.client=0,this.order=0,this.decorPercent=10,this.delivery=0,this.salePersent=0,this.dialogClear=!1,this.updateProps()},clientsFilter:function(t,e){var s=t.name.toLowerCase(),a=t.phone.replace(/[^0-9]/gim,""),i=e.toLowerCase();return s.indexOf(i)>-1||a.indexOf(i)>-1},submitForm:function(){var t=this,e=this.$refs.form.validate();if(e){this.createdSuccess=!0;var s={floristId:this.florist,clientId:this.client,orderId:this.order,totalCost:this.sumPay,decorPercent:this.decorPercent,decorCost:this.sumDecor,deliveryCost:this.delivery,salePercent:+this.clientSale,sumSale:this.sumSale,payment:{paymentTypeId:this.typePay,amount:this.sumPay,clientId:this.client,description:""},comment:this.comment,orderBouquet:this.orderBouquet};null===this.orderBouquet&&(s.payment.amount=this.sumPayCustom),setTimeout(function(){t.dialogPay=!1,t.$emit("saveProps",s)},1e3)}},updateProps:function(){var t={floristId:this.florist,clientId:this.client,orderId:this.order,totalCost:this.sumPay,decorPercent:this.decorPercent,decorCost:this.sumDecor,deliveryCost:this.delivery,salePercent:+this.clientSale,sumSale:this.sumSale,payment:{paymentTypeId:1,amount:this.sumPay,clientId:this.client,description:""},comment:this.comment,orderBouquet:this.orderBouquet};this.$emit("updateProps",t)},checkCard:function(){this.check=!this.check,this.$emit("checkCard",this.sumPay)},priceRound:function(t){return+t},setValueDefault:function(){Object.keys(this.propsDefault).length>0&&(this.florist=this.propsDefault.floristId,this.client=this.propsDefault.clientId,this.order=this.propsDefault.orderId,this.decorPercent=this.propsDefault.decorPercent,this.delivery=this.propsDefault.deliveryCost,this.clientSaleCustom=this.propsDefault.salePercent,this.comment=this.propsDefault.comment,this.orderBouquet=this.propsDefault.orderBouquet)}},updated:function(){},created:function(){this.setValueDefault(),this.getOrdersClient(!1)}},o=n,c=s("2877"),d=Object(c["a"])(o,r,l,!1,null,null,null),u=d.exports,v=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-card",{staticStyle:{"border-left":"1px solid #ccc","font-size":"16px"},attrs:{flat:"",width:"300"}},[s("div",{staticClass:"py-1 px-0 text-xs-center",staticStyle:{height:"30px"}},[t._v("Кол-во")]),s("v-divider"),t._l(t.goods,function(e,a){return[s("div",{key:a,staticClass:"px-0",staticStyle:{height:"30px"}},[s("v-text-field",{staticClass:"scs-small",attrs:{label:"0",solo:"",flat:"","hide-details":"",value:e.value>0?e.value:""},on:{input:function(e){t.setCountGood(a,e)}}}),t._v("\n      "+t._s(e.value)+"\n    ")],1),s("v-divider",{key:"divider-"+a})]})],2)},p=[],h={name:"SelectCountGoods",props:{goodsList:{type:Array,required:!0},selectedGoodsDefault:{type:Array}},data:function(){return{goods:[]}},computed:{selectedGoods:function(){var t=this.goods.filter(function(t){return t.value>0});return t},sumSelectedGoods:function(){for(var t=this.selectedGoods,e=0,s=0;s<t.length;s+=1)e+=t[s].price*t[s].value;return e}},methods:{setValueGoods:function(){var t=this.goodsList,e={};function s(t){return t.id===e.id}for(var a=0;a<t.length;a+=1){e=Object.assign({},t[a]);var i=this.selectedGoodsDefault.find(s);e.value=void 0!==i?i.value:0,this.goods.push(e)}},setCountGood:function(t,e){var s=this.goods[t];s.value=+e.replace(",","."),this.$set(this.goods,t,s),this.changeSum()},changeSum:function(){this.$emit("changeSum",this.sumSelectedGoods),this.$emit("changeGoods",this.selectedGoods)}},created:function(){this.setValueGoods()}},f=h,m=Object(c["a"])(f,v,p,!1,null,null,null),y=m.exports,g=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"statPayBlock"},[s("v-layout",{attrs:{row:"",wrap:"","align-center":""}},[s("v-flex",{attrs:{xs7:""}},[s("b",[t._v("Сумма оплат:")])]),s("v-flex",{attrs:{xs5:""}},[s("v-text-field",{staticClass:"scs-small",attrs:{solo:"",flat:"","hide-details":"",readonly:"",value:t.allSumPay}})],1)],1),s("v-layout",{attrs:{row:"",wrap:"","align-center":""}},[s("v-flex",{attrs:{xs7:""}},[s("b",[t._v("Сумма наличка:")])]),s("v-flex",{attrs:{xs5:""}},[s("v-text-field",{staticClass:"scs-small",attrs:{solo:"",flat:"","hide-details":"",readonly:"",value:t.allSumPayCash}})],1)],1),s("v-layout",{attrs:{row:"",wrap:"","align-center":""}},[s("v-flex",{attrs:{xs7:""}},[s("b",[t._v("Сумма безнал:")])]),s("v-flex",{attrs:{xs5:""}},[s("v-text-field",{staticClass:"scs-small",attrs:{solo:"",flat:"","hide-details":"",readonly:"",value:t.allSumPayNoCash}})],1)],1),s("v-layout",{attrs:{row:"",wrap:"","align-center":""}},[s("v-flex",{attrs:{xs7:""}},[s("b",[t._v("Сумма возвратов:")])]),s("v-flex",{attrs:{xs5:""}},[s("v-text-field",{staticClass:"scs-small",attrs:{solo:"",flat:"","hide-details":"",readonly:"",value:t.allSumReturn}})],1)],1),s("v-layout",{attrs:{row:"",wrap:"","align-center":""}},[s("v-flex",{attrs:{xs7:""}},[s("b",[t._v("Остаток в кассе:")])]),s("v-flex",{attrs:{xs5:""}},[s("v-text-field",{staticClass:"scs-small",attrs:{solo:"",flat:"","hide-details":"",readonly:"",value:t.cashPrevDay}})],1)],1),s("v-layout",{attrs:{row:"",wrap:"","align-center":""}},[s("v-flex",{attrs:{xs7:""}},[s("b",[t._v("Инкасация:")])]),s("v-flex",{attrs:{xs5:""}},[s("v-text-field",{staticClass:"scs-small",attrs:{solo:"",flat:"","hide-details":"",readonly:"",value:t.allSumEncashment}})],1)],1),s("v-layout",{attrs:{row:"",wrap:"","align-center":""}},[s("v-flex",{attrs:{xs7:""}},[s("b",[t._v("Сейчас в кассе:")])]),s("v-flex",{attrs:{xs5:""}},[s("v-text-field",{staticClass:"scs-small",attrs:{solo:"",flat:"","hide-details":"",readonly:"",value:t.cashNow}})],1)],1),s("v-btn",{attrs:{color:"info"},on:{click:function(e){t.dialog=!0}}},[t._v("Сдать инкассацию")]),s("v-dialog",{attrs:{persistent:"","max-width":"420px"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[s("v-card",[s("v-alert",{staticClass:"my-0",attrs:{value:t.createdSuccess,type:"success"}},[t._v("\n        Инкассация сдана\n      ")]),s("v-form",{ref:"form",attrs:{"lazy-validation":""}},[s("v-card-title",{staticClass:"px-4"},[s("span",{staticClass:"headline"},[t._v("Сдача инкассации")])]),s("v-divider"),s("v-card-text",{staticClass:"px-4"},[s("v-text-field",{attrs:{label:"Сумма",rules:[function(e){return e<=t.cashNow||"Недостаточно денег в кассе"}]},model:{value:t.sumEncashment,callback:function(e){t.sumEncashment=t._n(e)},expression:"sumEncashment"}})],1),s("v-card-actions",{staticClass:"px-4 pb-4"},[s("v-btn",{nativeOn:{click:function(e){t.dialog=!1}}},[t._v("Отмена")]),s("v-spacer"),s("v-btn",{attrs:{color:"info"},on:{click:function(e){t.submit()}}},[t._v("Оплатить")])],1)],1)],1)],1)],1)},x=[],C={props:{paymentsList:{type:Array,required:!0}},data:function(){return{dateNow:"",dateYesterday:"",createdSuccess:!1,dialog:!1,sumEncashment:0}},computed:{paymentsNow:function(){var t=this;return this.paymentsList.filter(function(e){return e.creationDate===t.dateNow})},paymentsPrevDay:function(){var t=this;return this.paymentsList.filter(function(e){return e.creationDate===t.dateYesterday})},allSumPay:function(){var t=this.paymentsNow.reduce(function(t,e){var s=0;return 7!==e.paymentType.id&&8!==e.paymentType.id&&(s=e.amount),t+s},0);return t},allSumPayCash:function(){var t=this.paymentsNow.reduce(function(t,e){var s=0;return 1===e.paymentType.id&&(s=e.amount),t+s},0);return t},allSumPayCashPrevDay:function(){var t=this.paymentsPrevDay.reduce(function(t,e){var s=0;return 1===e.paymentType.id&&(s=e.amount),t+s},0);return t},allSumPayNoCash:function(){var t=this.paymentsNow.reduce(function(t,e){var s=0;return 1!==e.paymentType.id&&7!==e.paymentType.id&&8!==e.paymentType.id&&(s=e.amount),t+s},0);return t},allSumReturn:function(){var t=this.paymentsNow.reduce(function(t,e){var s=0;return 7===e.paymentType.id&&(s=e.amount),t+s},0);return t},allSumEncashment:function(){var t=this.paymentsNow.reduce(function(t,e){var s=0;return 8===e.paymentType.id&&(s=e.amount),t+s},0);return t},allSumEncashmentPrevDay:function(){var t=this.paymentsPrevDay.reduce(function(t,e){var s=0;return 8===e.paymentType.id&&(s=e.amount),t+s},0);return t},cashPrevDay:function(){return this.allSumPayCashPrevDay-this.allSumEncashmentPrevDay},cashNow:function(){var t=this.cashPrevDay+this.allSumPayCash;return t-=this.allSumEncashment,t}},methods:{submit:function(){var t=this,e=this.$refs.form.validate();if(e){var s={type:"payments",props:{paymentType:{id:8,name:"Инкассация",isActive:!0,code:"collection"},amount:this.sumEncashment}};this.$store.dispatch("addItem",s).then(function(){t.createdSuccess=!0,t.$emit("input"),setTimeout(function(){t.dialog=!1,t.createdSuccess=!1},1e3)})}}},mounted:function(){var t=new Date,e=t.toISOString().split("T")[0];this.dateNow=e,t.setDate(t.getDate()-1);var s=t.toISOString().split("T")[0];this.dateYesterday=s}},b=C,P=(s("642e"),Object(c["a"])(b,g,x,!1,null,null,null)),S=P.exports,L={name:"Home",components:{"created-bouquet-card":u,"select-count-goods":y,PaymentDay:S},data:function(){return{dateNow:"",dateYesterday:"",loadingData:[{title:"Получение клиентов",error:!1,loading:!0,color:"indigo",id:"clients"},{title:"Получение флористов",error:!1,loading:!0,color:"cyan",id:"florists"},{title:"Получение товаров",error:!1,loading:!0,color:"blue-grey",id:"goods"},{title:"Получение оплат",error:!1,loading:!0,color:"deep-orange",id:"payments"}],offsetLeft:0,propsBouquet:["Флорист","Клиент","Заказ | Букет","Cтавка на оформление, %","Сумма товара","Доставка | Комментарий","Оформление","Ставка на скидку, % | Сумма скидки","Всего к оплате | Кол-во",""],cardsList:[],floristsList:[],clientsList:[],paymentTypesList:[],goodsList:[],paymentsList:[],checkCardList:[],createdSuccess:!1,dialogPay:!1,sumClient:0,typePay:null}},computed:{typePayList:function(){var t=this,e=this.checkCardList.some(function(e){var s=t.cardsList[e.index];return 7===s.props.clientId});return this.paymentTypesList.filter(function(t){var s=!0;return 7===t.id?s=!1:5===t.id&&e&&(s=!1),s})},sumChange:function(){var t=this.sumClient-this.checkSum;return t>0?t:0},checkSum:function(){return this.checkCardList.reduce(function(t,e){var s=t+e.sum;return s},0)},loadingDialog:function(){var t=this.loadingData.filter(function(t){return!t.error&&!t.loading});return t.length===this.loadingData.length?0:1}},methods:{onScroll:function(t){var e=t.target.scrollLeft;"scroll-block-top"===t.target.id&&(document.getElementById("scroll-block-bottom").scrollLeft=e)},setSum:function(t,e){var s=this.cardsList[t];s.sum=e,this.$set(this.cardsList,t,s)},setGoods:function(t,e){var s=this.cardsList[t];s.goods=e,this.$set(this.cardsList,t,s);var a=this.cardsList.filter(function(t){return(t.goods.length>0||Object.keys(t.props).length>0)&&!0!==t.success});localStorage.setItem("cardsList",JSON.stringify(a))},addCard:function(){this.cardsList.push({sum:0,success:!1,props:{},goods:[]})},checkCard:function(t,e){var s=this.checkCardList.findIndex(function(e){return e.index===t});s+1?this.checkCardList.splice(s,1):this.checkCardList.push({index:t,sum:e})},saveProps:function(t,e){var s=this;if(e){var a=this.cardsList[t];if(a.success=!0,this.$set(this.cardsList,t,a),this.addCard(),0===a.goods.length){var i={type:"payments",props:{paymentType:{id:e.payment.paymentTypeId,name:"На баланс",isActive:!0,code:"balance"},amount:e.payment.amount,clientId:e.payment.clientId,description:"На баланс"}};console.log(i),this.$store.dispatch("addItem",i).then(function(){s.getPaymentsList()})}else{var r=e;r.goods=a.goods.map(function(t){var e={goodId:t.id,count:t.value};return e});var l={type:"bouquets",props:r};this.$store.dispatch("addItem",l).then(function(){s.getPaymentsList()}),a.goods.forEach(function(t){var e=s.goodsList.find(function(e){return e.id===t.id});e.store-=t.value})}var n=this.cardsList.filter(function(t){return(t.goods.length>0||Object.keys(t.props).length>0)&&!0!==t.success});localStorage.setItem("cardsList",JSON.stringify(n));var o=this.checkCardList.findIndex(function(e){return e.index===t});o+1&&this.checkCardList.splice(o,1)}},updateProps:function(t,e){var s=this.cardsList[t];s.props=e,this.$set(this.cardsList,t,s);var a=this.cardsList.filter(function(t){return(t.goods.length>0||Object.keys(t.props).length>0)&&!0!==t.success});localStorage.setItem("cardsList",JSON.stringify(a))},getClientsList:function(){var t=this,e={type:"clients",filter:{isActive:!0}},s="Клиенты получены!",a="Ошибка получения клиентов!";this.$store.dispatch("getItemsList",e).then(function(a){t.clientsList=[],t.clientsList=t.clientsList.concat(a);var i=t.loadingData.find(function(t){return t.id===e.type});i.title=s,i.loading=!1}).catch(function(){var s=t.loadingData.find(function(t){return t.id===e.type});s.title=a,s.error=!0})},getFloristsList:function(){var t=this,e={type:"florists",filter:{isActive:!0}},s="Флористы получены!",a="Ошибка получения флористов!";this.$store.dispatch("getItemsList",e).then(function(a){t.floristsList=a;var i=t.loadingData.find(function(t){return t.id===e.type});i.title=s,i.loading=!1}).catch(function(){var s=t.loadingData.find(function(t){return t.id===e.type});s.title=a,s.error=!0})},getPaymentTypesList:function(){var t=this,e={type:"paymentTypes",filter:{isActive:!0}};this.$store.dispatch("getItemsList",e).then(function(e){t.paymentTypesList=e}).catch(function(){console.log("error")})},getGoodsList:function(){var t=this,e={type:"goods"},s="Товары получены!",a="Ошибка получения товаров!";this.$store.dispatch("getItemsList",e).then(function(a){t.goodsList=a;var i=t.loadingData.find(function(t){return t.id===e.type});i.title=s,i.loading=!1}).catch(function(){var s=t.loadingData.find(function(t){return t.id===e.type});s.title=a,s.error=!0})},getPaymentsList:function(){var t=this,e={type:"payments",filter:{creationDate:[this.dateYesterday,this.dateNow]}},s="Оплаты получены!",a="Ошибка получения оплат!";this.$store.dispatch("getItemsList",e).then(function(a){t.paymentsList=a;var i=t.loadingData.find(function(t){return t.id===e.type});i.title=s,i.loading=!1}).catch(function(){var s=t.loadingData.find(function(t){return t.id===e.type});s.title=a,s.error=!0})},getDataProps:function(){this.getClientsList(),this.getFloristsList(),this.getGoodsList(),this.getPaymentsList(),this.getPaymentTypesList()},copyItem:function(t){var e=Object.assign({},this.cardsList[t]);this.cardsList.push(e);var s=this.cardsList.filter(function(t){return(t.goods.length>0||Object.keys(t.props).length>0)&&!0!==t.success});localStorage.setItem("cardsList",JSON.stringify(s))},deleteItem:function(t){var e=this.cardsList[t];e.success=!0;var s=this.cardsList.filter(function(t){return(t.goods.length>0||Object.keys(t.props).length>0)&&!0!==t.success});localStorage.setItem("cardsList",JSON.stringify(s));var a=this.checkCardList.findIndex(function(e){return e.index===t});a+1&&this.checkCardList.splice(a,1)},pay:function(){var t=this;this.createdSuccess=!0;var e=this.checkCardList.slice();e.forEach(function(e){var s=t.cardsList[e.index];s.props.typePay=t.typePay,t.saveProps(e.index,s.props)}),setTimeout(function(){t.dialogPay=!1},1e3)},deleteCheckCards:function(){var t=this,e=this.checkCardList.slice();e.forEach(function(e){t.deleteItem(e.index)})}},mounted:function(){var t=new Date,e=t.toISOString().split("T")[0];this.dateNow="".concat(e," 23:59:59"),t.setDate(t.getDate()-1);var s=t.toISOString().split("T")[0];this.dateYesterday="".concat(s," 00:00:00");var a=JSON.parse(localStorage.getItem("cardsList"));this.cardsList=null!==a?a:[];for(var i=1-this.cardsList.length,r=0;r<i;r+=1)this.addCard();this.getDataProps()}},k=L,_=(s("21bb"),Object(c["a"])(k,a,i,!1,null,null,null));e["default"]=_.exports},bcc9:function(t,e,s){}}]);
//# sourceMappingURL=chunk-765913bf.bbb2e48d.js.map