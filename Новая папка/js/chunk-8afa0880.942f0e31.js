(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8afa0880"],{"112a":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{staticClass:"pa-0",attrs:{fluid:""}},[a("v-dialog",{attrs:{value:t.loadingDialog,persistent:"","max-width":"320px"}},[a("v-list",t._l(t.loadingData,function(e,s){return a("v-list-tile",{key:s,attrs:{avatar:"",color:e.error?"red":e.color}},[a("v-list-tile-avatar",[a("v-progress-circular",{attrs:{value:100,size:30,color:e.error?"red":e.color,indeterminate:e.loading}})],1),a("v-list-tile-content",[a("v-list-tile-title",[t._v(t._s(e.title))])],1)],1)}))],1),t.loadingDialog?t._e():[a("v-dialog",{attrs:{persistent:"","max-width":"420px"},model:{value:t.dialogForm,callback:function(e){t.dialogForm=e},expression:"dialogForm"}},[t.dialogForm?[a("good-add",{on:{cancel:function(e){t.closeDialogAdd()}}})]:t._e()],2),a("v-card",[a("v-alert",{staticClass:"my-0",attrs:{value:t.createdSuccess,type:"success"}},[t._v("\n        "+t._s(t.formAlertTitle)+"\n      ")]),a("v-form",{ref:"form",attrs:{"lazy-validation":""}},[a("v-card-title",[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs2:""}},[a("v-select",{staticClass:"pr-4",attrs:{label:"Тип изменения",items:t.typeEdit,rules:[function(t){return!!t||"Заполните поле"}],"item-text":"name","item-value":"id","hide-details":""},model:{value:t.dataEdit.type,callback:function(e){t.$set(t.dataEdit,"type",t._n(e))},expression:"dataEdit.type"}})],1),a("v-flex",{attrs:{xs2:""}},[a("v-text-field",{staticClass:"pr-4",attrs:{label:"Закупка",value:t.dataEdit.purchase,"hide-details":"",rules:[function(t){return""!==t&&void 0!==t||"Заполните поле"}]},on:{change:function(e){t.dataEdit.purchase=t.exelCalc(e)}}})],1),a("v-flex",{attrs:{xs2:""}},[a("v-text-field",{staticClass:"pr-4",attrs:{label:"Приход",value:t.arrival,"hide-details":"",readonly:""}})],1),a("v-flex",{attrs:{xs1:""}},[a("v-text-field",{staticClass:"pr-4",attrs:{label:"Наценка",value:t.markup+"%","hide-details":"",readonly:""}})],1),"Приход"===t.dataEdit.type||"Брак"===t.dataEdit.type?a("v-flex",{attrs:{xs3:""}},[a("v-text-field",{staticClass:"pr-4",attrs:{label:"Компания","hide-details":"",rules:[function(t){return!!t||"Заполните поле"}]},model:{value:t.dataEdit.company,callback:function(e){t.$set(t.dataEdit,"company",e)},expression:"dataEdit.company"}})],1):t._e(),a("v-flex",{attrs:{xs2:""}},[a("v-btn",{attrs:{color:"info"},on:{click:t.submitForm}},[t._v("Сохранить")])],1)],1)],1)],1)],1),a("v-card",[a("v-card-title",[a("v-text-field",{attrs:{"prepend-icon":"search",label:"Поиск","single-line":"","hide-details":""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),a("v-spacer"),a("v-btn",{attrs:{color:"info",to:"/goods/history/"}},[t._v("История")])],1),a("v-data-table",{attrs:{headers:t.headersTable,items:t.goodsList,"hide-actions":"","no-data-text":"Товаров не найдено","no-results-text":"Товаров не найдено",search:t.search,"disable-initial-sort":""},scopedSlots:t._u([{key:"items",fn:function(e){return[a("td",[a("v-text-field",{staticClass:"scs-small",attrs:{label:"Склад",solo:"",flat:"","hide-details":"",value:+e.item.stockBalance+ +e.item.count,readonly:""}})],1),a("td",[a("v-text-field",{staticClass:"scs-small",attrs:{label:"Название",solo:"",flat:"","hide-details":""},model:{value:e.item.name,callback:function(a){t.$set(e.item,"name",a)},expression:"props.item.name"}})],1),a("td",[a("v-text-field",{staticClass:"scs-small",attrs:{label:"Сортировка",solo:"",flat:"","hide-details":""},model:{value:e.item.sortIndex,callback:function(a){t.$set(e.item,"sortIndex",a)},expression:"props.item.sortIndex"}})],1),a("td",[a("v-text-field",{staticClass:"scs-small",attrs:{label:"Цена",solo:"",flat:"","hide-details":"",type:"number"},model:{value:e.item.price,callback:function(a){t.$set(e.item,"price",a)},expression:"props.item.price"}})],1),a("td",[a("v-text-field",{staticClass:"scs-small",attrs:{label:"Кол-во",solo:"",flat:"","hide-details":"",type:"text",value:e.item.count},on:{change:function(a){e.item.count=t.exelCalc(a)}}})],1),a("td",{staticClass:"text-xs-right",staticStyle:{width:"7%"}})]}}])}),a("v-btn",{staticClass:"mx-4",attrs:{fab:"",color:"info"},on:{click:function(e){t.dialogForm=!0}}},[a("v-icon",{attrs:{dark:""}},[t._v("add")])],1)],1)]],2)},i=[],l=a("6ffa"),r=l["a"],n=(a("82fb"),a("2877")),o=Object(n["a"])(r,s,i,!1,null,null,null);e["default"]=o.exports},"3d1b":function(t,e,a){},6621:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-card",[a("v-alert",{staticClass:"my-0",attrs:{value:t.createdSuccess,type:"success"}},[t._v("\n    Товар добавлен\n  ")]),a("v-form",{ref:"form",attrs:{"lazy-validation":""}},[a("v-card-title",{staticClass:"px-4"},[a("span",{staticClass:"headline"},[t._v("Добавление товара")])]),a("v-divider"),a("v-card-text",{staticClass:"px-4"},[a("v-text-field",{attrs:{label:"Название",rules:[function(t){return!!t||"Заполните поле"}]},model:{value:t.editedItem.name,callback:function(e){t.$set(t.editedItem,"name",e)},expression:"editedItem.name"}}),a("v-text-field",{attrs:{label:"Цена",rules:[function(t){return!!t||"Заполните поле"}],type:"number"},model:{value:t.editedItem.price,callback:function(e){t.$set(t.editedItem,"price",t._n(e))},expression:"editedItem.price"}}),a("v-text-field",{attrs:{label:"На складе",rules:[function(t){return!!t||"Заполните поле"}],type:"number"},model:{value:t.editedItem.stockBalance,callback:function(e){t.$set(t.editedItem,"stockBalance",t._n(e))},expression:"editedItem.stockBalance"}}),a("v-text-field",{attrs:{label:"Сортировка",rules:[function(t){return!!t||"Заполните поле"}],type:"number"},model:{value:t.editedItem.sortIndex,callback:function(e){t.$set(t.editedItem,"sortIndex",t._n(e))},expression:"editedItem.sortIndex"}})],1),a("v-card-actions",{staticClass:"px-4 pb-4"},[a("v-btn",{nativeOn:{click:function(e){t.cancel()}}},[t._v("Отмена")]),a("v-spacer"),a("v-btn",{attrs:{color:"info"},on:{click:t.submitForm}},[t._v("Сохранить")])],1)],1)],1)},i=[],l={data:function(){return{editedItem:{name:"",price:0,stockBalance:0,sortIndex:0},createdSuccess:!1}},methods:{cancel:function(){this.editedItem={},this.createdSuccess=!1,this.$emit("cancel")},submitForm:function(){var t=this,e=this.$refs.form.validate();if(e){var a=Object.assign({},this.editedItem);delete a.id;var s={type:"goods",props:a};this.$store.dispatch("addItem",s).then(function(){t.createdSuccess=!0,setTimeout(function(){t.$emit("cancel")},1e3)})}}}},r=l,n=a("2877"),o=Object(n["a"])(r,s,i,!1,null,null,null);e["a"]=o.exports},"6ffa":function(module,__webpack_exports__,__webpack_require__){"use strict";var _add_vue__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("6621");__webpack_exports__["a"]={name:"Goods",components:{GoodAdd:_add_vue__WEBPACK_IMPORTED_MODULE_0__["a"]},data:function(){return{loadingData:[{title:"Получение товаров",error:!1,loading:!0,color:"indigo",id:"goods"}],typeEdit:[],dataEdit:{type:0,company:"",purchase:0},search:"",headersTable:[{text:"Остаток",align:"left",value:"stockBalance"},{text:"Название",align:"left",value:"name"},{text:"Сортировка",align:"left",value:"sortIndex"},{text:"Цена",align:"left",value:"price"},{text:"Кол-во",align:"left",value:"count"},{text:"",align:"right",sortable:!1,value:"action"}],goodsList:[],createdSuccess:!1,dialogForm:!1}},computed:{loadingDialog:function(){var t=this.loadingData.filter(function(t){return!t.error&&!t.loading});return t.length===this.loadingData.length?0:1},formAlertTitle:function(){return"Остатки изменены"},arrival:function(){var t=this.goodsList.reduce(function(t,e){var a=+e.count*+e.price;return a+t},0);return t},markup:function(){var t=0;return 0!==this.arrival&&(t=100-100*this.dataEdit.purchase/this.arrival),+t.toFixed(2)}},methods:{exelCalc:function exelCalc(val){var value=val.length>1?val.replace(/^0+/,""):val;return console.log(value),eval(value)},getGoodsList:function(){var t=this,e={type:"goods",sort:{sortIndex:"asc"}},a="Товары получены!",s="Ошибка получения товаров!";this.$store.dispatch("getItemsList",e).then(function(s){t.goodsList=s.map(function(t){var e=t;return e.count=0,e});var i=t.loadingData.find(function(t){return t.id===e.type});i.title=a,i.loading=!1}).catch(function(){var a=t.loadingData.find(function(t){return t.id===e.type});a.title=s,a.error=!0})},getPurchaseTypesList:function(){var t=this,e={type:"purchase-types"};this.$store.dispatch("getItemsList",e).then(function(e){t.typeEdit=e.map(function(t){return t.id=+t.id,t})}).catch(function(){console.log("error")})},submitForm:function(){var t=this,e=this.$refs.form.validate();if(e){var a=this.goodsList.map(function(t){var e={estimate:t.count,newPrice:t.price,stockQuantity:t.stockBalance,good:t.id};return e}),s=Object.assign({},this.dataEdit),i=[a,this.arrival];s.purchasedGoods=i[0],s.arrival=i[1];var l={type:"purchase",props:s};this.$store.dispatch("addItem",l).then(function(){t.createdSuccess=!0,t.getGoodsList(),setTimeout(function(){t.closeDialog()},1e3)}),this.goodsList.forEach(function(e){var a=Object.assign({},e);a.stockBalance=+a.stockBalance+ +a.count,delete a.id,delete a.count,a.price=+a.price;var s={type:"goods",props:a,id:e.id};t.$store.dispatch("updateItem",s)})}},closeDialog:function(){this.createdSuccess=!1},closeDialogAdd:function(){this.getGoodsList(),this.dialogForm=!1}},mounted:function(){this.getGoodsList(),this.getPurchaseTypesList()}}},"82fb":function(t,e,a){"use strict";var s=a("3d1b"),i=a.n(s);i.a}}]);
//# sourceMappingURL=chunk-8afa0880.942f0e31.js.map